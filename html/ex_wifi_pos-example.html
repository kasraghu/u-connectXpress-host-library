<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>u-connectXpress host library: ex_wifi_pos</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ublox-logo.webp"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">u-connectXpress host library
   &#160;<span id="projectnumber">0.4</span>
   </div>
   <div id="projectbrief">AT and EDM parser for u-blox shortrange standalone modules</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ex_wifi_pos-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ex_wifi_pos</div>  </div>
</div><!--header-->
<div class="contents">
<p>Using EDM, configure WiFi, scan for APs and request position from Thingstream WiFi positioning server using MQTT over TLS Using EDM, configure WiFi, scan for APs and request position from Thingstream WiFi positioning server using MQTT over TLS </p>
<h2><a class="anchor" id="autotoc_md37"></a>
Introduction</h2>
<p>This example is a complete example, which shows how to Start the Serial Port Enter EDM Configure the module to connect to an AP Connect to a Thingstream WiFi positioning server at mqtt.thingstream.io using MQTT over TLS and the credentials configured in <a class="el" href="ex__config_8h.html">ex_config.h</a> Scan for nearby APs Publish the list of APs to the Thingstream WiFi positioning server using MQTT Obtain and print the position as determined by the Thingstream WiFi positioning server</p>
<dl class="section note"><dt>Note</dt><dd>In order for this example to work, you must obtain a Thingstream account and configure the flow for a WiFi positioning server. See the u-connectXpress IoT cloud connectivity application note at <a href="https://www.u-blox.com/en/docs/UBX-19010078">https://www.u-blox.com/en/docs/UBX-19010078</a> for more information.</dd></dl>
<p>Once configured, this example is driven by events, which are handled by the callbacks <a class="el" href="ex__wifi__pos_8c.html#a6e7724c82a506be32dbf496207a0f59c">onConnectIpV4()</a>, <a class="el" href="ex__wifi__pos_8c.html#a426c3e76219dfcea592b8c3721011dd9">onNetworkStationUp()</a>, <a class="el" href="ex__wifi__pos_8c.html#a6efabbd1e358ac61ebca6a4f82e3cc8e">onWifiScanHandler()</a> and <a class="el" href="ex__wifi__pos_8c.html#ab28ae1581a6be84ca672203be90ee23b" title="Prints the content of the data, asserting channel is -1.">onData()</a>.</p>
<p>A number of other callbacks, are registered as well, but these are only done to show how AT URCs and responses are reported as callbacks.</p>
<p>Full source in <code><a class="el" href="ex__wifi__pos_8c.html">examples/ex_wifi_pos.c</a></code></p>
<h2><a class="anchor" id="autotoc_md38"></a>
Typical response</h2>
<pre class="fragment">Opening serial port...
Entering AT mode (in case NINA was in DATA mode)...
Handling stray responses
ex_wifi_pos.c/onUnknownURC: 'AT'
Entering extended data mode (EDM)... ex_wifi_pos.c/onUnknownURC: 'ATO2'
Handling stray responses again
Query NINA...
Configuring WiFi...
Activating WiFi...




Polling for up to 60s. Ensure a TCP server at mqtt.thingstream.io is listening on port 8883...



ex_wifi_pos.c/onManufacturerIdentification:               Manufacturer:         'u-blox'
ex_wifi_pos.c/onModelIdentification:                      Model:                'NINA-W152'
ex_wifi_pos.c/onIdentificationInformation:                Application Version:  '3.0.0-013'
                                                          Unique Identifier:    'NINA-W15X-3.0.0-013-0-g259e42c3'
ex_wifi_pos.c/onSoftwareVersionIdentification:            Software Version:     '3.0.0-013'
ex_wifi_pos.c/onLocalAddress:                             Interface_id:         2 (WiFi STA)
                                                          MAC Address           'D4CA6EFD9674'
ex_wifi_pos.c/onWifiLinkConnected:                        connection_id:        0
                                                          BSSID:                'B03956E9E0D0'
                                                          WiFi channel:         11
ex_wifi_pos.c/onNetworkUp interface_id 0
ex_wifi_pos.c/onNetworkStatus:
  interface_hardware_address: 'D4CA6EFD9674'
  network_status: 1
  interface_id: 0
  interface_type: 1 (WIFI_STATION)
  ipv4_address: '192.168.0.128'
  ipv4_subnet_mask: '255.255.255.0'
  ipv4_gateway: '192.168.0.1'
  primary_dns_server: '192.168.0.1'
  secondary_dns_server: '192.168.0.1'
  ipv6_link_local_address: 'FE80::D6CA:6EFF:FEFD:9674'
  ipv6_address[0]: 'FE80::D6CA:6EFF:FEFD:9674', 2
  ipv6_address[1]: '::', 0
  ipv6_address[2]: '::', 0

==== Main loop detected WiFi Station interface configured and up. ====


Manually trying to connect to mqtt.thingstream.io:8883
ex_wifi_pos.c/onPeerDisconnected peer_handle 2
ex_wifi_pos.c/onDisconnect: Channel 0: Disconnect event, lastChannel=-1, numberOfConnections=0


Main loop detected disconnection. Let's manually try to reconnect again...



==== Main loop detected WiFi Station interface configured and up. ====


Manually trying to connect to mqtt.thingstream.io:8883
ex_wifi_pos.c/onConnectIpV4: Channel 1: Connection event to localport 0 from 52.211.238.211:8883, protocol MQTT, lastChannel=-1
ex_wifi_pos.c/onPeerConnected: peer_handle 2
  IPv4 local_port: 0
  IPv4 remote_port: 8883
  IPv4 protocol: 6 (MQTT)
  IPv4 local_address: '0.0.0.0'
  IPv4 remote_address: '52.211.238.211'

==== MQTT connection successfull ====



Main loop detected connection on channel 1: Performing WiFi Scan.

Sending Wifi Scan
ex_wifi_pos.c/onWifiScanHandler:  1062EBF242F4,3,dlink-C9D4-EXT,-54
ex_wifi_pos.c/onWifiScanHandler:  908D7823C9D4,3,dlink-C9D4,-73
ex_wifi_pos.c/onWifiScanHandler:  9EDAC43107EE,8,,-88
ex_wifi_pos.c/onWifiScanHandler:  88D7F64684B8,9,Muppet labs,-83
ex_wifi_pos.c/onWifiScanHandler:  021599A8C94A,9,DIRECT-gmCLP-360 Series,-84
ex_wifi_pos.c/onWifiScanHandler:  B03956E9E0D0,11,Mehet-Weret_2GEXT,-41
ex_wifi_pos.c/onWifiScanHandler:  D847325256D1,11,Mehet-Weret-2G,-68
ex_wifi_pos.c/onWifiScanHandler:  EA47325256D1,11,,-71
ex_wifi_pos.c/onWifiScanHandlerOk: Scan complete
ex_wifi_pos.c/onData: Channel 1: Data event of 46 bytes: '{"longitude":12.983666,"latitude":55.6128367}'
</pre><div class="fragment"></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
