<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>u-connectXpress host library: Extending the library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ublox-logo.webp"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">u-connectXpress host library
   &#160;<span id="projectnumber">0.4</span>
   </div>
   <div id="projectbrief">AT and EDM parser for u-blox shortrange standalone modules</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__extending.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Extending the library</div>  </div>
</div><!--header-->
<div class="contents">

<p>Instructions to support new commands, requests and URCs.  
<a href="#details">More...</a></p>
<p>Instructions to support new commands, requests and URCs. </p>
<p>To add the parsing of an URC or responses from a command request, such as "NFC URI tag content" <code>+UNFCURI</code>, follow these instructions, but replace <code>XXX</code> with the CamelCase name of the URC, such as <code>NfcUriTagContent</code>, and <code>UUU</code> with the actual URC, such as <code>UNFCURI</code>.</p>
<ol type="1">
<li>Add a line to the <a class="el" href="ucxh__urc_8h.html#a44fe167118c2a781861ba3efcb020106">LIST_OF_PLUS_URC</a> #define in <a class="el" href="ucxh__urc_8h.html">ucxh_urc.h</a> .</li>
<li>Add a typedef struct named <code><a class="el" href="structucxh_p_a_r_s_e_r__urc_x_x_x_event__t.html" title="Generic event declaration for an URC or response to a command request named XXX, such as NfcUriTagCon...">ucxhPARSER_urcXXXEvent_t</a></code>, containing the parsed parameters from the URC to the <a class="el" href="ucxh__urc_8h.html">ucxh_urc.h</a> file.<ul>
<li>Ensure the field names in the struct is named as they are named in the AT command manual, UNLESS the name in the AT command manual is OBVIOUSLY incorrect, in which case the AT command manual should be changed. If so, please contact u-blox through your normal channel, or file a question on the u-blox forum <a href="https://portal.u-blox.com/s/">https://portal.u-blox.com/s/</a></li>
<li>Use an enum and union to differentiate between different formats of the URC, e.g. URCs that contains either IP adresses or Bluetooth adresses. For an example, see <code><a class="el" href="structucxh_p_a_r_s_e_r__urc_peer_connected_event__t.html">ucxhPARSER_urcPeerConnectedEvent_t</a></code>.</li>
</ul>
</li>
<li><p class="startli">Implement a function with the function definition </p><div class="fragment"><div class="line"><span class="keyword">extern</span> <a class="code" href="ucxh__urc_8h.html#aa90077b35ac464b34ccee14ada3ceb65">ucxhURC_parseResult_t</a> <a class="code" href="group__autogenerated.html#gaaf2b167887891e46105e6462a1d0acb8">onUUU_createEvent</a>(uint8_t numParams, <span class="keyword">const</span> <span class="keywordtype">char</span> *ppParams[], <a class="code" href="structucxh_p_a_r_s_e_r__urc_x_x_x_event__t.html">ucxhPARSER_urcXXXEvent_t</a> *pEvent);</div>
</div><!-- fragment --><ul>
<li><code>numParams</code> Indicates the number if parameters in the ppParms array, or 0.</li>
<li><code>ppParams</code> It points to an array of NUL-termitted pointers to each parameter, or NULL.</li>
<li><code>pEvent</code> Is allocated and deallocated by the caller (and typically placed on the stack). The function must assume its content is uninitialized. Only update its content upon successfully parsing the parameters.</li>
<li>Return<ul>
<li><code>ucxhURC_PARSE_RESULT_OK</code> if <code>pEvent</code> is ready to be issued to a registered callback,</li>
<li><code>ucxhURC_PARSE_RESULT_NEED_MORE</code> if not. In such case, the content of <code>pEvent</code> shall be undefined, and will not be forwarded to any registered callback. Instead, the <code>OK</code> response from the module will cause this function to be invoked again, but with <code>0, NULL</code> as <code>numParams</code> and <code>ppParams</code>.</li>
<li><code>ucxhURC_PARSE_RESULT_ERROR</code> if parsing failed and it is impossible to generate a valid <code>pEvent</code>.</li>
</ul>
</li>
<li>The function is responsible for parsing the content of <code>pParams</code>, and fill the <code>pEvent</code> with the data.<ul>
<li>If <code>numParams</code> is 0 AND <code>ppParams</code> is NULL, the function is invoked as a result of an <code>OK</code> response.</li>
<li>If the function previously returned <code>ucxhURC_PARSE_RESULT_NEED_MORE</code>, the function MUST fill the <code>pEvent</code> with the result parsed so far and return <code>ucxhURC_PARSE_RESULT_OK</code>.</li>
<li>The function must be liberal with parsing the content of <code>pParams</code>, for example:<ul>
<li>Accept undocumented values and values out-of-range. However, logging the presence of such value is recommended. It is the responsibility of the client which registers itself as recipient of callbacks to the event, to handle undocumented values and values out of range.</li>
<li>Allow (and disregard) more parameters than documented</li>
<li>Accept empty values - if so, set the corresponding field to 0 or empty string.</li>
</ul>
</li>
</ul>
</li>
<li>The function may use a number of utility macros and functions, such as<ul>
<li><a class="el" href="ucxh__parser_8h.html#a0d01c12621c32851f362d22b787416a5">ASSERTPARAMS()</a></li>
<li><a class="el" href="ucxh__parser_8h.html#a985e3cadc623536bc23f503a6c4490df">STRCPY2ARRAY()</a></li>
<li><a class="el" href="ucxh__parser_8h.html#ab4a0992e18e9368a7dcf9b34ee1eea1b">STRCPY2ARRAYORFAIL()</a></li>
<li><a class="el" href="ucxh__parser_8h.html#a71ff00e420f7bcaf561f97882d8d4108">STRCPY2INT()</a></li>
<li><a class="el" href="ucxh__parser_8h.html#a9dc97ea4ff6af459d77ef9971034be2e">STRCPY2INTORFAIL()</a></li>
<li><a class="el" href="ucxh__parser_8h.html#a8c3e5875915fc54562b5869711ec7a38">ucxhPARSER_printBuffer()</a></li>
<li><a class="el" href="group__utility.html#ga915ee66fc8ba3ea72390354b61569369">ucxhPARSER_isIpV4Address()</a></li>
<li><a class="el" href="group__utility.html#gac1c321c7427719c52a1b2e1ed4655c1b">ucxhPARSER_isValidIpV4Address()</a></li>
<li><a class="el" href="group__utility.html#gaafd41343117106e014a4d196626f6f55">ucxhPARSER_isIpV6Address()</a></li>
<li><a class="el" href="group__utility.html#ga5e4bb63b33ec287f89ffcf1ba24c0bc2">ucxhPARSER_isValidIpV6Address()</a></li>
</ul>
</li>
<li>For trivial events, that only contains a single parameter, <a class="el" href="ucxh__urc_8h.html#a01484e9da6faaaaeb02bd2cee4d2b663">TRIVIAL_EVENT</a> can also be used to define the entire function.</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>Do NOT use pointers in the returned <code>pEvent</code>. </dd>
<dd>
Do NOT save any pointer to the content of <code>ppParams</code> for future use.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Do NOT create a function prototype, since that is done by the X-MACROS. The X-MACROs will also generate a function pointer and setter for the callback registration with the names <div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="group__autogenerated.html#gab90dcd73cc916fda9f699e8d06e6318a">ucxhPARSER_setOnXXX</a>(<span class="keywordtype">int</span> (*callback)(<a class="code" href="structucxh_p_a_r_s_e_r__urc_x_x_x_event__t.html">ucxhPARSER_urcXXXEvent_t</a> *pEvent));</div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="group__autogenerated.html#gad5b2febba2dbf74fad9eb8a728c26673">ucxhPARSER_setOnXXXOk</a>(<span class="keywordtype">int</span> (*callback)(<span class="keywordtype">void</span> *_));</div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="group__autogenerated.html#gac940a6334ca1ea7cf554c06f3798e961">ucxhPARSER_setOnXXXError</a>(<span class="keywordtype">int</span> (*callback)(<span class="keywordtype">void</span> *_));</div>
</div><!-- fragment --> </dd></dl>
</li>
</ol>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aucxh__urc_8h_html_aa90077b35ac464b34ccee14ada3ceb65"><div class="ttname"><a href="ucxh__urc_8h.html#aa90077b35ac464b34ccee14ada3ceb65">ucxhURC_parseResult_t</a></div><div class="ttdeci">ucxhURC_parseResult_t</div><div class="ttdef"><b>Definition:</b> <a href="ucxh__urc_8h_source.html#l00087">ucxh_urc.h:87</a></div></div>
<div class="ttc" id="agroup__autogenerated_html_gab90dcd73cc916fda9f699e8d06e6318a"><div class="ttname"><a href="group__autogenerated.html#gab90dcd73cc916fda9f699e8d06e6318a">ucxhPARSER_setOnXXX</a></div><div class="ttdeci">LIST_OF_PLUS_URC bool ucxhPARSER_setOnXXX(int(*callback)(ucxhPARSER_urcXXXEvent_t *pEvent))</div><div class="ttdoc">Generic function declaration for registration of callback for an URC or response to a command request...</div></div>
<div class="ttc" id="agroup__autogenerated_html_gad5b2febba2dbf74fad9eb8a728c26673"><div class="ttname"><a href="group__autogenerated.html#gad5b2febba2dbf74fad9eb8a728c26673">ucxhPARSER_setOnXXXOk</a></div><div class="ttdeci">LIST_OF_PLUS_URC bool ucxhPARSER_setOnXXXOk(int(*callback)(void *_))</div><div class="ttdoc">Generic function declaration for registration of callback invoked when OK is received for a command r...</div></div>
<div class="ttc" id="astructucxh_p_a_r_s_e_r__urc_x_x_x_event__t_html"><div class="ttname"><a href="structucxh_p_a_r_s_e_r__urc_x_x_x_event__t.html">ucxhPARSER_urcXXXEvent_t</a></div><div class="ttdoc">Generic event declaration for an URC or response to a command request named XXX, such as NfcUriTagCon...</div><div class="ttdef"><b>Definition:</b> <a href="ucxh__urc_8h_source.html#l00803">ucxh_urc.h:803</a></div></div>
<div class="ttc" id="agroup__autogenerated_html_gaaf2b167887891e46105e6462a1d0acb8"><div class="ttname"><a href="group__autogenerated.html#gaaf2b167887891e46105e6462a1d0acb8">onUUU_createEvent</a></div><div class="ttdeci">LIST_OF_PLUS_URC ucxhURC_parseResult_t onUUU_createEvent(uint8_t numParams, const char *ppParams[], ucxhPARSER_urcXXXEvent_t *pEvent)</div><div class="ttdoc">Generic function declaration for a function which parses a line to create an event for a URC or repon...</div></div>
<div class="ttc" id="agroup__autogenerated_html_gac940a6334ca1ea7cf554c06f3798e961"><div class="ttname"><a href="group__autogenerated.html#gac940a6334ca1ea7cf554c06f3798e961">ucxhPARSER_setOnXXXError</a></div><div class="ttdeci">LIST_OF_PLUS_URC bool ucxhPARSER_setOnXXXError(int(*callback)(void *_))</div><div class="ttdoc">Generic function declaration for registration of callback invoked when ERROR is received for a comman...</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
