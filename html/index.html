<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>u-connectXpress host library: Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ublox-logo.webp"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">u-connectXpress host library
   &#160;<span id="projectnumber">0.4</span>
   </div>
   <div id="projectbrief">AT and EDM parser for u-blox shortrange standalone modules</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Introduction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The u-connectXpress host library is an example on how to interface the u-blox standalone shortrange modules with a host of any kind. The AT commands are normally transmitted in the AT mode, but this library also supports transmitting AT commands and receiving data using the Extended Data Mode (EDM), which significantly simplifies the development of more advanced products on the host MCU.</p>
<p>The u-connectXpress AT protocol is implemented in the u-connectXpress software for the following u-blox standalone shortrange modules:</p>
<ul>
<li>ANNA-B1</li>
<li>NINA-B1</li>
<li>NINA-B2</li>
<li>NINA-B31</li>
<li>NINA-B41</li>
<li>NINA-W13</li>
<li>NINA-W15</li>
<li>ODIN-W2</li>
</ul>
<p>Use this library on the host to</p>
<ul>
<li>Transmit AT commands to the module using AT mode or EDM</li>
<li>Receive and manage URC responses using AT mode or EDM</li>
<li>Transmit raw data to any peer connected to the module using Data mode or EDM</li>
<li>Receive raw data from any peer connected to the module using Data mode or EDM</li>
</ul>
<p>While this example is written for Windows, it is trivial to convert it to any other host, including Raspberry PI, FreeRTOS, or hostless embedded MCUs such as STMicroelectronics STM32 series.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Running your first example on CygWin</h2>
<p>The example will issue some commands to your module, and display the responses.</p>
<ul>
<li>Connect a NINA-W13, NINA-W15 or ODIN-W2 to your computer.</li>
<li>Define the serial port to use in the <code><a class="el" href="ucxh__config_8h.html">include/ucxh_config.h</a></code> file.</li>
<li>Open a command terminal on your PC and start <pre class="fragment">./runExamples.sh --run ex_readmisc
</pre></li>
</ul>
<p><a class="el" href="ex_readmisc-example.html">More information ...</a></p>
<h2><a class="anchor" id="autotoc_md3"></a>
Running the second examples on CygWin</h2>
<p>This example will show how to communicate with another device over WiFi, using EDM between your NINA-W13, NINA-W14 or ODIN-W2 module and your PC.</p>
<ul>
<li>Connect a NINA-W13, NINA-W15 or ODIN-W2 to your computer.</li>
<li>Define the serial port to use in the <code><a class="el" href="ucxh__config_8h.html">include/ucxh_config.h</a></code> file.</li>
<li>Configure your network and create a small server. This can be done either by connecting to your existing network, and using your computer as a server, or by using another NINA-W10/W13 or ODIN-W2 as WiFi AP and/or server:<ul>
<li>To use another u-blox module as WiFi AP and server, configure it to use IP number and gateway address <code>192.168.2.1</code>, and enable a TCP server on port <code>12345</code>. This is easiest done using <code>s-center</code>.<ul>
<li>In s-center, connect to the u-blox standalone module you intend to use as WiFI AP.</li>
<li>From the File menu, select Download Configuration and select the file <code>resources/config_ex_callbacks_edm_wifi.txt</code>.</li>
<li>Once the module has activated the WiFi AP, enter Data Mode, by pressing the button at the bottom.</li>
<li>Open a command terminal on your PC and start <pre class="fragment"> ./runExamples.sh --run ex_callbacks_edm_wifi
</pre></li>
<li>When propmted by the example, type something into the s-center input box. Some text appears on the program's terminal, and the example will echo back the result.</li>
</ul>
</li>
<li>To use your own network and PC as server you need some form of program capable of accepting incoming connections on your pc, such as <code>nc</code>.<ul>
<li>Edit the <code><a class="el" href="ex__config_8h.html">examples/ex_config.h</a></code> file, and replace the SSID, and password with the one used on your network, and the IP-number with your PC's IP-number.</li>
<li>Open a command terminal on your PC, start netcat using <pre class="fragment">nc -l -k 12345
</pre></li>
<li>Open a new terminal on your PC and start <pre class="fragment">./runExamples.sh --run ex_callbacks_edm_wifi
</pre></li>
<li>When propmted by the example, type something into netcat's terminal. Some text appears on the program's terminal, and the example will echo back the result.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Independent on method, the example will quit automatically after 2 minutes. It can also be aborted by sending the line <code>quit</code> from the server.</p>
<p><a class="el" href="ex_callbacks_edm_wifi-example.html">More information ...</a></p>
<h2><a class="anchor" id="autotoc_md4"></a>
Using the AT command library with your host application</h2>
<ul>
<li>ensure your <code><a class="el" href="ucxh__config_8h.html">include/ucxh_config.h</a></code> is configured properly</li>
<li>Compile and link the files in the <code>src</code> directory as well as the <code>src/windows/ucxh_serial_win.c</code> file with your application.</li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
Documentation</h1>
<p>See the examples for various use-cases</p>
<p>For full documentation see the <code>html/index.html</code> file.</p>
<p>For documentation on the EDM packet format, see the u-blox Extended Data Mode Protocol Specification at <a href="https://www.u-blox.com/en/docs/UBX-14044126">https://www.u-blox.com/en/docs/UBX-14044126</a></p>
<p>For documentation on the u-blox u-connectXpress AT command set for the u-blox shortrange standalone modes, see the u-connect AT commands manual at <a href="https://www.u-blox.com/en/docs/UBX-14044127">https://www.u-blox.com/en/docs/UBX-14044127</a></p>
<h1><a class="anchor" id="autotoc_md6"></a>
Examples</h1>
<h2><a class="anchor" id="autotoc_md7"></a>
ex_readmisc</h2>
<p>This example shows how to read various parameters from the module.</p>
<p><a class="el" href="ex_readmisc-example.html">More information ...</a></p>
<h2><a class="anchor" id="autotoc_md8"></a>
ex_callbacks_edm_wifi</h2>
<p>This example is a shows how to connect to a remote host using EDM:</p>
<ul>
<li>Enter Extended Data Mode (EDM)</li>
<li>Configure the module as a WiFi station</li>
<li>Wait until the WiFi link is up and the module has received a DHCP IP address.</li>
<li>Connect to a server (for example a PC)</li>
<li>Transmit raw data to the server</li>
<li>Receive raw data from the server</li>
<li>Reboot</li>
</ul>
<p><a class="el" href="ex_callbacks_edm_wifi-example.html">More information ...</a></p>
<h2><a class="anchor" id="autotoc_md9"></a>
ex_wifi_pos</h2>
<p>This example shows how to scan for APs and request position from Thingstream WiFi positioning server using MQTT over TLS:</p>
<ul>
<li>Enter Extended Data Mode (EDM)</li>
<li>Configure the module to connect to an AP</li>
<li>Connect to a Thingstream WiFi positioning server at mqtt.thingstream.io using MQTT over TLS and the credentials configured in <a class="el" href="ex__config_8h.html">ex_config.h</a></li>
<li>Scan for nearby APs</li>
<li>Publish the list of APs to the Thingstream WiFi positioning server using MQTT</li>
<li>Obtain and print the position as determined by the Thingstream WiFi positioning server</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>In order for this example to work, you must obtain a Thingstream account and configure the flow for a WiFi positioning server. See the u-connectXpress IoT cloud connectivity application note at <a href="https://www.u-blox.com/en/docs/UBX-19010078">https://www.u-blox.com/en/docs/UBX-19010078</a> for more information.</dd></dl>
<p><a class="el" href="ex_wifi_pos-example.html">More information ...</a></p>
<h2><a class="anchor" id="autotoc_md10"></a>
ex_http_get</h2>
<p>This example is a shows how to connect to a HTTP-server and issue a GET-command:</p>
<ul>
<li>Enter Extended Data Mode (EDM)</li>
<li>Configure the module as a WiFi station</li>
<li>Wait until the WiFi link is up and the module has received a DHCP IP address.</li>
<li>Connect to a remote server.</li>
<li>Reboot</li>
</ul>
<p><a class="el" href="ex_http_get-example.html">More information ...</a></p>
<h1><a class="anchor" id="autotoc_md11"></a>
Porting</h1>
<p>The library has been tested using gcc on CygWin, with the only file which contains Microsoft Windows-specific code, is ucxh_serial_win.c, in the <code>src/windows</code> directory.</p>
<p>Replace that file with code which implements the interface described in serial.h .</p>
<p>In order to port to an RTOS, such as FreeRTOS, a few lines needs to be changed in <a class="el" href="group__internal.html#ga3ea523311f50bfc3d2267a10bd21722b">atParseResponse()</a> of the <code>src/ucxh_parser.c</code> file</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Testing</h1>
<p>A number of test programs for unit-tests, and some programs with an expected output are also available, when <code>runExamples.sh</code> is executed:</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Unit-tests</h2>
<h3><a class="anchor" id="autotoc_md14"></a>
test_getgeneral</h3>
<p>Unit-test for the generation and parsing of General commands from chapter 3 in the u-connectXpress AT command manual.</p>
<p><a class="el" href="test__getgeneral_8c.html">More information ...</a></p>
<h3><a class="anchor" id="autotoc_md15"></a>
test_getsystem</h3>
<p>Unit-test for the generation and parsing of System commands from chapter 4 in the u-connectXpress AT command manual.</p>
<p><a class="el" href="test__getsystem_8c.html">More information ...</a></p>
<h3><a class="anchor" id="autotoc_md16"></a>
test_at_wifi</h3>
<p>Unit-test for the generation and parsing of WiFi commands from chapter 7 and some Network command from chapter 10 in the u-connectXpress AT command manual.</p>
<p><a class="el" href="test__at__wifi_8c.html">More information ...</a></p>
<h3><a class="anchor" id="autotoc_md17"></a>
test_tokenizer</h3>
<p>Unit-test for the tokenizer part of the library.</p>
<p><a class="el" href="test__tokenizer_8c.html">More information ...</a></p>
<h3><a class="anchor" id="autotoc_md18"></a>
test_send</h3>
<p>Unit-testing the functions used for building and sending AT commands.</p>
<p><a class="el" href="test__send_8c.html">More information ...</a></p>
<h3><a class="anchor" id="autotoc_md19"></a>
test_mock_ati9</h3>
<p>Unit-testinf for the actual mocking framework, mimicing the behavior of <code>\ref <a class="el" href="test__ati9_8c.html" title="Tests Hello, World / Issue AT command.">test_ati9.c</a></code> .</p>
<p><a class="el" href="test__mock__ati9_8c.html">More information ...</a></p>
<h2><a class="anchor" id="autotoc_md20"></a>
Manual test</h2>
<h3><a class="anchor" id="autotoc_md21"></a>
test_ati9</h3>
<p>This test is a basic "Hello, World", which - using AT mode - tests</p>
<ul>
<li>Open the serial port</li>
<li>Enter AT mode</li>
<li>Transmit an AT command</li>
<li>Receive the response</li>
<li>Close the serial port</li>
</ul>
<p><a class="el" href="test__ati9_8c.html">More information ...</a></p>
<h3><a class="anchor" id="autotoc_md22"></a>
test_datamode</h3>
<p>This test is a partial test which - using AT mode and Data mode - tests</p>
<ul>
<li>Enter the Data mode</li>
<li>Transmit raw data in the Data mode</li>
</ul>
<p><a class="el" href="test__datamode_8c.html">More information ...</a></p>
<h3><a class="anchor" id="autotoc_md23"></a>
test_edm_at</h3>
<p>This test is a basic Hello, World, which - using EDM - tests</p>
<ul>
<li>Enter EDM mode</li>
<li>Transmit an AT command</li>
<li>Receive the response</li>
<li>Leave EDM mode</li>
</ul>
<p><a class="el" href="test__edm__at_8c.html">More information ...</a></p>
<h3><a class="anchor" id="autotoc_md24"></a>
test_edm_at_read</h3>
<p>This test is a basic Hello, World, which - using EDM - tests</p>
<ul>
<li>Enter EDM mode</li>
<li>Ensure nothing is received apart from responses from AT-c</li>
<li>Leave EDM mode</li>
</ul>
<p><a class="el" href="test__edm__at_8c.html">More information ...</a></p>
<p>All testing has been done using gcc 9.2.0 on CygWin connected to either NINA-W152 2.1.0 or NINA-W132 2.1.0.</p>
<h1><a class="anchor" id="autotoc_md25"></a>
Using runExamples.sh</h1>
<p>By default, it will</p>
<ul>
<li>Run all examples</li>
<li>Execute all automatic unit-tests</li>
<li>Execute all manual unit-tests</li>
<li>Re-generate all documentation (assuming <code>doxygen</code> and <code>graphwiz</code> is installed).</li>
</ul>
<h1><a class="anchor" id="autotoc_md26"></a>
Revision history</h1>
<h2><a class="anchor" id="autotoc_md27"></a>
0.3</h2>
<p>Initial public release.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
0.4</h2>
<p>New examples:</p><ul>
<li>ex_wifi_pos: Example shows how to scan for APs and request position from Thingstream WiFi positioning server using MQTT over TLS <a class="el" href="ex_wifi_pos-example.html">More information ...</a></li>
<li>ex_http_get: Example shows how to connect to a HTTP-server and issue a GET-command <a class="el" href="ex_http_get-example.html">More information ...</a></li>
</ul>
<p>Fixed some bugs:</p><ul>
<li>EDM parse failed for incomingg packets &gt; 128 bytes</li>
<li>Potential buffer overflow in createUrlQueryString()</li>
<li>Non-portable integer conversion in <a class="el" href="ucxh__parser_8h.html#a71ff00e420f7bcaf561f97882d8d4108">STRCPY2INT()</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md29"></a>
Disclaimer</h1>
<p>Copyright (C) u-blox</p>
<p>u-blox reserves all rights in this deliverable (documentation, software, etc., hereafter “Deliverable”).</p>
<p>u-blox grants you the right to use, copy, modify and distribute the Deliverable provided hereunder for any purpose without fee.</p>
<p>THIS DELIVERABLE IS BEING PROVIDED "AS IS", WITHOUT ANY EXPRESS OR IMPLIED WARRANTY. IN PARTICULAR, NEITHER THE AUTHOR NOR U-BLOX MAKES ANY REPRESENTATION OR WARRANTY OF ANY KIND CONCERNING THE MERCHANTABILITY OF THIS DELIVERABLE OR ITS FITNESS FOR ANY PARTICULAR PURPOSE.</p>
<p>In case you provide us a feedback or make a contribution in the form of a further development of the Deliverable (“Contribution”), u-blox will have the same rights as granted to you, namely to use, copy, modify and distribute the Contribution provided to us for any purpose without fee. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
